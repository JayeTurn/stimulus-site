{%- assign section_pages = site.pages | where: "section", page.section -%}

{%- assign ordered = section_pages | map: "order" | compact | first -%}
{%- if ordered -%}
  {%- assign section_pages = section_pages | sort: "order" -%}
{%- endif -%}

<section class="docs__index">
  <input type="checkbox" id="hamburger" class="docs__checkbox">
  <label class="docs__mobile-button" for="hamburger"><span></span> Table of Contents</label>

  <nav class="docs__nav">
    <label class="docs__mobile-button docs__mobile-button--close" for="hamburger"><span></span> close</label>

    <p class="docs__nav-title">{{ page.section_title }}:</p>
    <ul class="docs__nav-list">
      {%- for section_page in section_pages -%}
        {%- assign is_active = false -%}
        {%- if page.url == section_page.url -%}
          {%- assign is_active = true -%}
          {%- assign next_section_page = section_pages[forloop.index] -%}
        {%- endif -%}
        <li>
          <a class="docs__nav-link{% if is_active %} active{% endif %}" href="{{ section_page.url }}">
            {%- assign prefix = section_page.nav_prefix -%}
            {%- unless prefix -%}
              {%- assign index = section_page.path | split: "/" | reverse | first | abs -%}
              {%- if index > 0 -%}
                {%- assign prefix = forloop.index0 -%}
              {%- endif -%}
            {%- endunless -%}
            {%- if prefix %}{{ prefix }}: {% endif %}{{ section_page.title }}
          </a>
        </li>
      {%- endfor -%}
    </ul>
  </nav>
</section>
